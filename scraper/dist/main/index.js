'use strict';

var _rxjs = require('rxjs');

var _rxjs2 = _interopRequireDefault(_rxjs);

var _ioc = require('./../ioc');

var _utils = require('./utils');

var _config = require('./../config');

var _config2 = _interopRequireDefault(_config);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// Start scrapping
(0, _utils.createDefensivePromise)(async function (resolve, reject) {
  var scrape = await _ioc.dependencies.scrape;

  _rxjs2.default.Observable.interval(_config2.default.scraper.fetchInterval)
  // eslint-disable-next-line no-console
  .map(function (_) {
    return scrape().catch(function (er) {
      return console.error(er);
    });
  }).reduce(function (resultA, resultB) {
    return Promise.all([resultA, resultB]);
  }).map(resolve).catch(reject) // this should be handled by another observable
  .finally(resolve).subscribe();
}).catch(function (e) {
  // eslint-disable-next-line no-console
  console.error(e);
}).finally(async function () {
  var redisClient = await _ioc.dependencies.redisClient;

  await redisClient.quit();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tYWluL2luZGV4LmpzIl0sIm5hbWVzIjpbInJlc29sdmUiLCJyZWplY3QiLCJzY3JhcGUiLCJPYnNlcnZhYmxlIiwiaW50ZXJ2YWwiLCJzY3JhcGVyIiwiZmV0Y2hJbnRlcnZhbCIsIm1hcCIsImNhdGNoIiwiY29uc29sZSIsImVycm9yIiwiZXIiLCJyZWR1Y2UiLCJyZXN1bHRBIiwicmVzdWx0QiIsIlByb21pc2UiLCJhbGwiLCJmaW5hbGx5Iiwic3Vic2NyaWJlIiwiZSIsInJlZGlzQ2xpZW50IiwicXVpdCJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7OztBQUVBOztBQUNBOztBQUNBOzs7Ozs7QUFFQTtBQUNBLG1DQUF1QixnQkFBT0EsT0FBUCxFQUFnQkMsTUFBaEIsRUFBMkI7QUFDaEQsTUFBTUMsU0FBUyxNQUFNLGtCQUFhQSxNQUFsQzs7QUFFQSxpQkFBR0MsVUFBSCxDQUNHQyxRQURILENBQ1ksaUJBQU9DLE9BQVAsQ0FBZUMsYUFEM0I7QUFFRTtBQUZGLEdBR0dDLEdBSEgsQ0FHTztBQUFBLFdBQUtMLFNBQVNNLEtBQVQsQ0FBZTtBQUFBLGFBQU1DLFFBQVFDLEtBQVIsQ0FBY0MsRUFBZCxDQUFOO0FBQUEsS0FBZixDQUFMO0FBQUEsR0FIUCxFQUlHQyxNQUpILENBSVUsVUFBQ0MsT0FBRCxFQUFVQyxPQUFWO0FBQUEsV0FBc0JDLFFBQVFDLEdBQVIsQ0FBWSxDQUFDSCxPQUFELEVBQVVDLE9BQVYsQ0FBWixDQUF0QjtBQUFBLEdBSlYsRUFLR1AsR0FMSCxDQUtPUCxPQUxQLEVBTUdRLEtBTkgsQ0FNU1AsTUFOVCxFQU1pQjtBQU5qQixHQU9HZ0IsT0FQSCxDQU9XakIsT0FQWCxFQVFHa0IsU0FSSDtBQVNELENBWkQsRUFZR1YsS0FaSCxDQVlTLGFBQUs7QUFDWjtBQUNBQyxVQUFRQyxLQUFSLENBQWNTLENBQWQ7QUFDRCxDQWZELEVBZUdGLE9BZkgsQ0FlVyxrQkFBWTtBQUNyQixNQUFNRyxjQUFjLE1BQU0sa0JBQWFBLFdBQXZDOztBQUVBLFFBQU1BLFlBQVlDLElBQVosRUFBTjtBQUNELENBbkJEIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJ4IGZyb20gJ3J4anMnXG5cbmltcG9ydCB7IGRlcGVuZGVuY2llcyB9IGZyb20gJy4vLi4vaW9jJ1xuaW1wb3J0IHsgY3JlYXRlRGVmZW5zaXZlUHJvbWlzZSB9IGZyb20gJy4vdXRpbHMnXG5pbXBvcnQgY29uZmlnIGZyb20gJy4vLi4vY29uZmlnJ1xuXG4vLyBTdGFydCBzY3JhcHBpbmdcbmNyZWF0ZURlZmVuc2l2ZVByb21pc2UoYXN5bmMgKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICBjb25zdCBzY3JhcGUgPSBhd2FpdCBkZXBlbmRlbmNpZXMuc2NyYXBlXG5cbiAgUnguT2JzZXJ2YWJsZVxuICAgIC5pbnRlcnZhbChjb25maWcuc2NyYXBlci5mZXRjaEludGVydmFsKVxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gICAgLm1hcChfID0+IHNjcmFwZSgpLmNhdGNoKGVyID0+IGNvbnNvbGUuZXJyb3IoZXIpKSlcbiAgICAucmVkdWNlKChyZXN1bHRBLCByZXN1bHRCKSA9PiBQcm9taXNlLmFsbChbcmVzdWx0QSwgcmVzdWx0Ql0pKVxuICAgIC5tYXAocmVzb2x2ZSlcbiAgICAuY2F0Y2gocmVqZWN0KSAvLyB0aGlzIHNob3VsZCBiZSBoYW5kbGVkIGJ5IGFub3RoZXIgb2JzZXJ2YWJsZVxuICAgIC5maW5hbGx5KHJlc29sdmUpXG4gICAgLnN1YnNjcmliZSgpXG59KS5jYXRjaChlID0+IHtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgY29uc29sZS5lcnJvcihlKVxufSkuZmluYWxseShhc3luYyAoKSA9PiB7XG4gIGNvbnN0IHJlZGlzQ2xpZW50ID0gYXdhaXQgZGVwZW5kZW5jaWVzLnJlZGlzQ2xpZW50XG5cbiAgYXdhaXQgcmVkaXNDbGllbnQucXVpdCgpXG59KVxuIl19
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
// Extracts only the required data
var extract = function extract(_ref, baseUrl) {
  var feed = _ref.feed;

  var requiredData = feed.entry.map(function (en) {
    var author = en.author[0];
    return {
      updateTime: new Date(Date.parse(en.updated[0])),
      event: en.id[0].split(':')[2].split('/')[0],
      author: {
        name: author.name[0],
        uri: author.uri[0].replace(baseUrl, '')
      }
    };
  });
  return requiredData;
};

// ETL's required data from endpoint to persistence

exports.default = function (_ref2) {
  var url = _ref2.url,
      baseUrlGetter = _ref2.baseUrlGetter,
      dataFetcher = _ref2.dataFetcher,
      xmlToJsonConverter = _ref2.xmlToJsonConverter,
      odm = _ref2.odm;
  return async function () {
    var baseUrl = await baseUrlGetter({ url: url });

    var _ref3 = await dataFetcher({ url: url }),
        data = _ref3.data;

    var jsonData = await xmlToJsonConverter({ xml: data });
    var requiredData = extract(jsonData, baseUrl);

    return Promise.all(requiredData.map(function (reqData) {
      return odm.create({ key: reqData.author.uri, data: reqData }).save();
    }));
  };
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9tYWluL3NlcnZpY2VzL3NjcmFwZXIuanMiXSwibmFtZXMiOlsiZXh0cmFjdCIsImJhc2VVcmwiLCJmZWVkIiwicmVxdWlyZWREYXRhIiwiZW50cnkiLCJtYXAiLCJhdXRob3IiLCJlbiIsInVwZGF0ZVRpbWUiLCJEYXRlIiwicGFyc2UiLCJ1cGRhdGVkIiwiZXZlbnQiLCJpZCIsInNwbGl0IiwibmFtZSIsInVyaSIsInJlcGxhY2UiLCJ1cmwiLCJiYXNlVXJsR2V0dGVyIiwiZGF0YUZldGNoZXIiLCJ4bWxUb0pzb25Db252ZXJ0ZXIiLCJvZG0iLCJkYXRhIiwianNvbkRhdGEiLCJ4bWwiLCJQcm9taXNlIiwiYWxsIiwiY3JlYXRlIiwia2V5IiwicmVxRGF0YSIsInNhdmUiXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7QUFDQSxJQUFNQSxVQUFVLFNBQVZBLE9BQVUsT0FBV0MsT0FBWCxFQUF1QjtBQUFBLE1BQXBCQyxJQUFvQixRQUFwQkEsSUFBb0I7O0FBQ3JDLE1BQU1DLGVBQWVELEtBQUtFLEtBQUwsQ0FBV0MsR0FBWCxDQUFlLGNBQU07QUFDeEMsUUFBTUMsU0FBU0MsR0FBR0QsTUFBSCxDQUFVLENBQVYsQ0FBZjtBQUNBLFdBQU87QUFDTEUsa0JBQVksSUFBSUMsSUFBSixDQUFTQSxLQUFLQyxLQUFMLENBQVdILEdBQUdJLE9BQUgsQ0FBVyxDQUFYLENBQVgsQ0FBVCxDQURQO0FBRUxDLGFBQU9MLEdBQUdNLEVBQUgsQ0FBTSxDQUFOLEVBQVNDLEtBQVQsQ0FBZSxHQUFmLEVBQW9CLENBQXBCLEVBQXVCQSxLQUF2QixDQUE2QixHQUE3QixFQUFrQyxDQUFsQyxDQUZGO0FBR0xSLGNBQVE7QUFDTlMsY0FBTVQsT0FBT1MsSUFBUCxDQUFZLENBQVosQ0FEQTtBQUVOQyxhQUFLVixPQUFPVSxHQUFQLENBQVcsQ0FBWCxFQUFjQyxPQUFkLENBQXNCaEIsT0FBdEIsRUFBK0IsRUFBL0I7QUFGQztBQUhILEtBQVA7QUFRRCxHQVZvQixDQUFyQjtBQVdBLFNBQU9FLFlBQVA7QUFDRCxDQWJEOztBQWVBOztrQkFDZTtBQUFBLE1BQUdlLEdBQUgsU0FBR0EsR0FBSDtBQUFBLE1BQVFDLGFBQVIsU0FBUUEsYUFBUjtBQUFBLE1BQXVCQyxXQUF2QixTQUF1QkEsV0FBdkI7QUFBQSxNQUFvQ0Msa0JBQXBDLFNBQW9DQSxrQkFBcEM7QUFBQSxNQUF3REMsR0FBeEQsU0FBd0RBLEdBQXhEO0FBQUEsU0FDYixrQkFBWTtBQUNWLFFBQU1yQixVQUFVLE1BQU1rQixjQUFjLEVBQUVELFFBQUYsRUFBZCxDQUF0Qjs7QUFEVSxnQkFFTyxNQUFNRSxZQUFZLEVBQUVGLFFBQUYsRUFBWixDQUZiO0FBQUEsUUFFRkssSUFGRSxTQUVGQSxJQUZFOztBQUdWLFFBQU1DLFdBQVcsTUFBTUgsbUJBQW1CLEVBQUVJLEtBQUtGLElBQVAsRUFBbkIsQ0FBdkI7QUFDQSxRQUFNcEIsZUFBZUgsUUFBUXdCLFFBQVIsRUFBa0J2QixPQUFsQixDQUFyQjs7QUFFQSxXQUFPeUIsUUFBUUMsR0FBUixDQUFZeEIsYUFBYUUsR0FBYixDQUFpQjtBQUFBLGFBQ2xDaUIsSUFBSU0sTUFBSixDQUFXLEVBQUVDLEtBQUtDLFFBQVF4QixNQUFSLENBQWVVLEdBQXRCLEVBQTJCTyxNQUFNTyxPQUFqQyxFQUFYLEVBQXVEQyxJQUF2RCxFQURrQztBQUFBLEtBQWpCLENBQVosQ0FBUDtBQUVELEdBVFk7QUFBQSxDIiwiZmlsZSI6InNjcmFwZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBFeHRyYWN0cyBvbmx5IHRoZSByZXF1aXJlZCBkYXRhXG5jb25zdCBleHRyYWN0ID0gKHsgZmVlZCB9LCBiYXNlVXJsKSA9PiB7XG4gIGNvbnN0IHJlcXVpcmVkRGF0YSA9IGZlZWQuZW50cnkubWFwKGVuID0+IHtcbiAgICBjb25zdCBhdXRob3IgPSBlbi5hdXRob3JbMF1cbiAgICByZXR1cm4ge1xuICAgICAgdXBkYXRlVGltZTogbmV3IERhdGUoRGF0ZS5wYXJzZShlbi51cGRhdGVkWzBdKSksXG4gICAgICBldmVudDogZW4uaWRbMF0uc3BsaXQoJzonKVsyXS5zcGxpdCgnLycpWzBdLFxuICAgICAgYXV0aG9yOiB7XG4gICAgICAgIG5hbWU6IGF1dGhvci5uYW1lWzBdLFxuICAgICAgICB1cmk6IGF1dGhvci51cmlbMF0ucmVwbGFjZShiYXNlVXJsLCAnJylcbiAgICAgIH1cbiAgICB9XG4gIH0pXG4gIHJldHVybiByZXF1aXJlZERhdGFcbn1cblxuLy8gRVRMJ3MgcmVxdWlyZWQgZGF0YSBmcm9tIGVuZHBvaW50IHRvIHBlcnNpc3RlbmNlXG5leHBvcnQgZGVmYXVsdCAoeyB1cmwsIGJhc2VVcmxHZXR0ZXIsIGRhdGFGZXRjaGVyLCB4bWxUb0pzb25Db252ZXJ0ZXIsIG9kbSB9KSA9PlxuICBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgYmFzZVVybCA9IGF3YWl0IGJhc2VVcmxHZXR0ZXIoeyB1cmwgfSlcbiAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGRhdGFGZXRjaGVyKHsgdXJsIH0pXG4gICAgY29uc3QganNvbkRhdGEgPSBhd2FpdCB4bWxUb0pzb25Db252ZXJ0ZXIoeyB4bWw6IGRhdGEgfSlcbiAgICBjb25zdCByZXF1aXJlZERhdGEgPSBleHRyYWN0KGpzb25EYXRhLCBiYXNlVXJsKVxuXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKHJlcXVpcmVkRGF0YS5tYXAocmVxRGF0YSA9PlxuICAgICAgb2RtLmNyZWF0ZSh7IGtleTogcmVxRGF0YS5hdXRob3IudXJpLCBkYXRhOiByZXFEYXRhIH0pLnNhdmUoKSkpXG4gIH1cbiJdfQ==
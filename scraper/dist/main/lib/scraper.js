'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
// Extracts only the required data
var extract = function extract(_ref, baseUrl) {
  var feed = _ref.feed;

  var requiredData = feed.entry.map(function (en) {
    var author = en.author[0];
    return {
      updateTime: new Date(Date.parse(en.updated[0])),
      event: en.id[0].split(':')[2].split('/')[0],
      author: {
        name: author.name[0],
        uri: author.uri[0].replace(baseUrl, '')
      }
    };
  });
  return requiredData;
};

// ETL's required data from endpoint to persistence

exports.default = async function (_ref2) {
  var url = _ref2.url,
      baseUrlGetter = _ref2.baseUrlGetter,
      dataFetcher = _ref2.dataFetcher,
      xmlToJsonConverter = _ref2.xmlToJsonConverter,
      odm = _ref2.odm;

  var baseUrl = await baseUrlGetter(url);

  var _ref3 = await dataFetcher(url),
      data = _ref3.data;

  var jsonData = await xmlToJsonConverter(data);
  var requiredData = extract(jsonData, baseUrl);

  return Promise.all(requiredData.map(function (reqData) {
    return odm.create(reqData).save();
  }));
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9tYWluL2xpYi9zY3JhcGVyLmpzIl0sIm5hbWVzIjpbImV4dHJhY3QiLCJiYXNlVXJsIiwiZmVlZCIsInJlcXVpcmVkRGF0YSIsImVudHJ5IiwibWFwIiwiYXV0aG9yIiwiZW4iLCJ1cGRhdGVUaW1lIiwiRGF0ZSIsInBhcnNlIiwidXBkYXRlZCIsImV2ZW50IiwiaWQiLCJzcGxpdCIsIm5hbWUiLCJ1cmkiLCJyZXBsYWNlIiwidXJsIiwiYmFzZVVybEdldHRlciIsImRhdGFGZXRjaGVyIiwieG1sVG9Kc29uQ29udmVydGVyIiwib2RtIiwiZGF0YSIsImpzb25EYXRhIiwiUHJvbWlzZSIsImFsbCIsImNyZWF0ZSIsInJlcURhdGEiLCJzYXZlIl0sIm1hcHBpbmdzIjoiOzs7OztBQUFBO0FBQ0EsSUFBTUEsVUFBVSxTQUFWQSxPQUFVLE9BQVdDLE9BQVgsRUFBdUI7QUFBQSxNQUFwQkMsSUFBb0IsUUFBcEJBLElBQW9COztBQUNyQyxNQUFNQyxlQUFlRCxLQUFLRSxLQUFMLENBQVdDLEdBQVgsQ0FBZSxjQUFNO0FBQ3hDLFFBQU1DLFNBQVNDLEdBQUdELE1BQUgsQ0FBVSxDQUFWLENBQWY7QUFDQSxXQUFPO0FBQ0xFLGtCQUFZLElBQUlDLElBQUosQ0FBU0EsS0FBS0MsS0FBTCxDQUFXSCxHQUFHSSxPQUFILENBQVcsQ0FBWCxDQUFYLENBQVQsQ0FEUDtBQUVMQyxhQUFPTCxHQUFHTSxFQUFILENBQU0sQ0FBTixFQUFTQyxLQUFULENBQWUsR0FBZixFQUFvQixDQUFwQixFQUF1QkEsS0FBdkIsQ0FBNkIsR0FBN0IsRUFBa0MsQ0FBbEMsQ0FGRjtBQUdMUixjQUFRO0FBQ05TLGNBQU1ULE9BQU9TLElBQVAsQ0FBWSxDQUFaLENBREE7QUFFTkMsYUFBS1YsT0FBT1UsR0FBUCxDQUFXLENBQVgsRUFBY0MsT0FBZCxDQUFzQmhCLE9BQXRCLEVBQStCLEVBQS9CO0FBRkM7QUFISCxLQUFQO0FBUUQsR0FWb0IsQ0FBckI7QUFXQSxTQUFPRSxZQUFQO0FBQ0QsQ0FiRDs7QUFlQTs7a0JBQ2UsdUJBQ1Q7QUFBQSxNQURrQmUsR0FDbEIsU0FEa0JBLEdBQ2xCO0FBQUEsTUFEdUJDLGFBQ3ZCLFNBRHVCQSxhQUN2QjtBQUFBLE1BRHNDQyxXQUN0QyxTQURzQ0EsV0FDdEM7QUFBQSxNQURtREMsa0JBQ25ELFNBRG1EQSxrQkFDbkQ7QUFBQSxNQUR1RUMsR0FDdkUsU0FEdUVBLEdBQ3ZFOztBQUNKLE1BQU1yQixVQUFVLE1BQU1rQixjQUFjRCxHQUFkLENBQXRCOztBQURJLGNBRWEsTUFBTUUsWUFBWUYsR0FBWixDQUZuQjtBQUFBLE1BRUlLLElBRkosU0FFSUEsSUFGSjs7QUFHSixNQUFNQyxXQUFXLE1BQU1ILG1CQUFtQkUsSUFBbkIsQ0FBdkI7QUFDQSxNQUFNcEIsZUFBZUgsUUFBUXdCLFFBQVIsRUFBa0J2QixPQUFsQixDQUFyQjs7QUFFQSxTQUFPd0IsUUFBUUMsR0FBUixDQUFZdkIsYUFBYUUsR0FBYixDQUFpQjtBQUFBLFdBQVdpQixJQUFJSyxNQUFKLENBQVdDLE9BQVgsRUFBb0JDLElBQXBCLEVBQVg7QUFBQSxHQUFqQixDQUFaLENBQVA7QUFDRCxDIiwiZmlsZSI6InNjcmFwZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBFeHRyYWN0cyBvbmx5IHRoZSByZXF1aXJlZCBkYXRhXG5jb25zdCBleHRyYWN0ID0gKHsgZmVlZCB9LCBiYXNlVXJsKSA9PiB7XG4gIGNvbnN0IHJlcXVpcmVkRGF0YSA9IGZlZWQuZW50cnkubWFwKGVuID0+IHtcbiAgICBjb25zdCBhdXRob3IgPSBlbi5hdXRob3JbMF1cbiAgICByZXR1cm4ge1xuICAgICAgdXBkYXRlVGltZTogbmV3IERhdGUoRGF0ZS5wYXJzZShlbi51cGRhdGVkWzBdKSksXG4gICAgICBldmVudDogZW4uaWRbMF0uc3BsaXQoJzonKVsyXS5zcGxpdCgnLycpWzBdLFxuICAgICAgYXV0aG9yOiB7XG4gICAgICAgIG5hbWU6IGF1dGhvci5uYW1lWzBdLFxuICAgICAgICB1cmk6IGF1dGhvci51cmlbMF0ucmVwbGFjZShiYXNlVXJsLCAnJylcbiAgICAgIH1cbiAgICB9XG4gIH0pXG4gIHJldHVybiByZXF1aXJlZERhdGFcbn1cblxuLy8gRVRMJ3MgcmVxdWlyZWQgZGF0YSBmcm9tIGVuZHBvaW50IHRvIHBlcnNpc3RlbmNlXG5leHBvcnQgZGVmYXVsdCBhc3luYyAoeyB1cmwsIGJhc2VVcmxHZXR0ZXIsIGRhdGFGZXRjaGVyLCB4bWxUb0pzb25Db252ZXJ0ZXIsIG9kbVxufSkgPT4ge1xuICBjb25zdCBiYXNlVXJsID0gYXdhaXQgYmFzZVVybEdldHRlcih1cmwpXG4gIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgZGF0YUZldGNoZXIodXJsKVxuICBjb25zdCBqc29uRGF0YSA9IGF3YWl0IHhtbFRvSnNvbkNvbnZlcnRlcihkYXRhKVxuICBjb25zdCByZXF1aXJlZERhdGEgPSBleHRyYWN0KGpzb25EYXRhLCBiYXNlVXJsKVxuXG4gIHJldHVybiBQcm9taXNlLmFsbChyZXF1aXJlZERhdGEubWFwKHJlcURhdGEgPT4gb2RtLmNyZWF0ZShyZXFEYXRhKS5zYXZlKCkpKVxufVxuIl19